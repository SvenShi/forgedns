# Repository Guidelines

## Project Structure & Module Organization
- `src/` contains the Rust source; `src/main.rs` is the entry point and runtime setup.
- Core infrastructure lives under `src/core/`, configuration types under `src/config/`, and protocol/upstream logic under `src/network/`.
- Plugin implementations are in `src/plugin/` (server and executor plugins).
- Runtime configuration ships as `config.yaml`; sample plugins and server settings live there.
- Build artifacts go to `target/` (generated by Cargo).

## Build, Test, and Development Commands
- `cargo build --release` builds an optimized binary.
- `cargo run -- -c config.yaml` runs ForgeDNS with the default config.
- `cargo run -- -l debug` overrides log level for local debugging.
- `cargo test` runs unit tests embedded in source modules.

## Coding Style & Naming Conventions
- Rust 2024 edition; follow standard Rust formatting via `cargo fmt`, with comments written in English.
- Indentation is 4 spaces; keep modules cohesive and colocate helpers with their feature area.
- Use `snake_case` for functions/fields, `CamelCase` for types, and `SCREAMING_SNAKE_CASE` for constants.
- Prefer descriptive plugin tags in config (e.g., `forward`, `udp_server`, `seq`).

## Performance & Architecture Principles
- This project targets extreme performance; DNS is foundational, so any overhead must be justified.
- Prefer low-latency, low-allocation, reusable designs; avoid locks or blocking on hot paths.
- Emphasize extensibility and pluginization; new capabilities should be plugins or clean module boundaries.

## Testing Guidelines
- Tests use Rustâ€™s built-in test framework (`#[test]`), generally co-located in the module under test.
- Favor unit tests near logic-heavy modules (see examples in `src/network/upstream/mod.rs`).
- No explicit coverage target; add tests for protocol handling and plugin behavior.

## Commit & Pull Request Guidelines
- Commits follow a conventional style with emoji and scope, e.g. `:bug: (scope): Fix ...`, and use English.
- Keep messages short and action-focused; include a scope when touching a subsystem.
- PRs should describe behavior changes, configuration updates, and include a test plan (commands run).
- If modifying config defaults, explain the impact on `config.yaml`.

## Configuration Tips
- `config.yaml` defines logging, plugin chains, and server listeners.
- When introducing new plugins or protocol handlers, update sample config entries and README as needed.
